---
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import Base from '../layouts/Base.astro';
import { readingTime } from "../lib/utils";

const posts = (await getCollection('blog')).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<Base>
  <section>
    <div class="flex flex-col gap-10 my-10 prose dark:prose-invert prose-headings:font-semibold prose-headings:tracking-tight max-w-none divide-y divide-gray-600">
      {
        posts.map((post) => (
          <a
            href={`/posts/${post.slug}`}
            class="hover:opacity-75 transition-opacity duration-300 flex flex-col justify-between no-underline pb-4"
          >
            <h1 class="mb-2!"
              transition:name={`title-${post.data.title}`}
            >
              {post.data.title}
            </h1>

            <div class="flex items-center flex-wrap gap-x-3 gap-y-0 opacity-75">
              <p class="flex items-center gap-2 mb-0 mt-0">
                <svg xmlns="http://www.w3.org/2000/svg" class="inline w-[1em] h-[1em]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-icon lucide-calendar"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
                <FormattedDate
                  date={post.data.pubDate}
                  name={`date-${post.data.title}`}
                />
              </p>
              <p class="flex items-center gap-2 mb-0 mt-0">
                <svg xmlns="http://www.w3.org/2000/svg" class="inline w-[1em] h-[1em]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock3-icon lucide-clock-3"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16.5 12"/></svg>
                <span>{readingTime(post.body)}</span>
              </p>
            </div>
          </a>
        ))
      }
    </div>
  </section>
</Base>
